# Планировщик для Calypso на основе SLURM

## Цикл работы

Планировщик обеспечивает цикл работы Calypso:

1. Запуск исполняемого файла `calypso.x` в рабочей папке Calypso
2. Проверка, изменился ли файл `step` и появились ли новые структуры `POSCAR_*`
3. Если нет, то выход. Если да, то создаётся директория задачи slurm для текущего поколения и каждый файл `POSCAR_M` поколения `N` копируется в неё в `task_N / job_M / POSCAR_ORIGINAL`. Создаются подпапки `step_K` для каждого этапа релаксации по числу файлов `INCAR_*` в директории входных файлов, также оттуда копируется `POTCAR`.
4. Подготавливается временный `task.sbatch`, запускающий `task.py` в подготовленной директории задачи `task_M`. Скрипт последовательно, одну структуру за другой, один этап за другим, проводит расчёт, запуская VASP в нужных директориях и копируя выходные файлы. Статус заданий отмечается в `status.json`, вывод `task.py` - в `task.out` и `task.err` в директории `task_M`.
5. Проверяется состояние отправленной задачи для расчёта поколения структур. Если она всё ещё в очереди (в ожидании или работает), то планировщик ожидает, если нет, то проверяет результаты.
calypso-slurm-scheduler
